<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heidelberg Gallery</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #0a0a0a;
            color: #fff;
            line-height: 1.6;
        }

        header {
            text-align: center;
            padding: 3rem 2rem;
            background: linear-gradient(135deg, #1a1a1a 0%, #0a0a0a 100%);
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 300;
            margin-bottom: 1rem;
            letter-spacing: 2px;
        }

        .download-btn {
            display: inline-block;
            margin-top: 1rem;
            padding: 0.75rem 2rem;
            background: #fff;
            color: #0a0a0a;
            text-decoration: none;
            border-radius: 50px;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 255, 255, 0.1);
        }

        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(255, 255, 255, 0.2);
        }

        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .gallery-item {
            position: relative;
            overflow: hidden;
            border-radius: 8px;
            cursor: pointer;
            aspect-ratio: 3/2;
            background: #1a1a1a;
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.4s ease;
        }

        .gallery-item:hover img {
            transform: scale(1.05);
        }

        .lightbox {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .lightbox.active {
            display: flex;
        }

        .lightbox-content {
            max-width: 90%;
            max-height: 90%;
            position: relative;
        }

        .lightbox-content img {
            max-width: 100%;
            max-height: 90vh;
            object-fit: contain;
        }

        .lightbox-close {
            position: absolute;
            top: 2rem;
            right: 2rem;
            font-size: 3rem;
            color: #fff;
            cursor: pointer;
            background: none;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s ease;
        }

        .lightbox-close:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .lightbox-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            font-size: 3rem;
            color: #fff;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .lightbox-nav:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .lightbox-prev {
            left: 2rem;
        }

        .lightbox-next {
            right: 2rem;
        }

        .lightbox-download {
            position: absolute;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            padding: 0.75rem 2rem;
            background: #fff;
            color: #0a0a0a;
            text-decoration: none;
            border-radius: 50px;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 255, 255, 0.1);
            font-size: 0.9rem;
        }

        .lightbox-download:hover {
            transform: translateX(-50%) translateY(-2px);
            box-shadow: 0 6px 25px rgba(255, 255, 255, 0.2);
        }

        .slideshow-btn {
            position: absolute;
            bottom: 2rem;
            right: 2rem;
            padding: 0.75rem 1.5rem;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: 2px solid #fff;
            border-radius: 50px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
        }

        .slideshow-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .slideshow-btn.playing {
            background: #fff;
            color: #0a0a0a;
        }

        .load-more-container {
            text-align: center;
            padding: 2rem;
        }

        .load-more-btn {
            display: inline-block;
            padding: 1rem 3rem;
            background: #fff;
            color: #0a0a0a;
            text-decoration: none;
            border-radius: 50px;
            font-weight: 500;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 255, 255, 0.1);
            font-size: 1rem;
        }

        .load-more-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(255, 255, 255, 0.2);
        }

        .load-more-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .loader {
            border: 3px solid #333;
            border-top: 3px solid #fff;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        footer {
            text-align: center;
            padding: 2rem;
            color: #666;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .gallery {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 1rem;
                padding: 1rem;
            }

            h1 {
                font-size: 1.8rem;
            }

            .lightbox-nav {
                width: 45px;
                height: 45px;
                font-size: 2rem;
            }

            .lightbox-prev {
                left: 1rem;
            }

            .lightbox-next {
                right: 1rem;
            }

            .lightbox-close {
                top: 1rem;
                right: 1rem;
                width: 40px;
                height: 40px;
                font-size: 2rem;
            }

            .lightbox-download {
                bottom: 1rem;
                left: 1rem;
                transform: none;
                padding: 0.6rem 1.2rem;
                font-size: 0.85rem;
            }

            .lightbox-download:hover {
                transform: translateY(-2px);
            }

            .slideshow-btn {
                bottom: 1rem;
                right: 1rem;
                padding: 0.6rem 1.2rem;
                font-size: 0.85rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Heidelberg</h1>
        <p>Fotogalerie</p>
        <a href="https://cdn.mulvany.net/2023-ff-heidelberg/2023-ff-heidelberg-images.zip" class="download-btn" download>Alle Bilder herunterladen</a>
    </header>

    <div class="gallery" id="gallery"></div>

    <div class="load-more-container" id="load-more-container">
        <div class="loader"></div>
    </div>

    <div class="lightbox" id="lightbox">
        <button class="lightbox-close" onclick="closeLightbox()">&times;</button>
        <button class="lightbox-nav lightbox-prev" onclick="changeImage(-1)">&#8249;</button>
        <div class="lightbox-content">
            <img id="lightbox-img" src="" alt="">
        </div>
        <button class="lightbox-nav lightbox-next" onclick="changeImage(1)">&#8250;</button>
        <a id="lightbox-download" class="lightbox-download" href="" download>Herunterladen</a>
        <button id="slideshow-btn" class="slideshow-btn" onclick="toggleSlideshow()">Diashow abspielen</button>
    </div>

    <footer>
        <p>&copy; 2023 Heidelberg Gallery</p>
    </footer>

    <script>
        const cdnBase = 'https://cdn.mulvany.net/2023-ff-heidelberg/';
        const imageFiles = [
            'DSCF8200.jpeg',
            'DSCF8205 Edited.jpeg',
            'DSCF8205.jpeg',
            'DSCF8215.jpeg',
            'DSCF8244.jpeg',
            'DSCF8245.jpeg',
            'DSCF8248.jpeg',
            'DSCF8250.jpeg',
            'DSCF8251.jpeg',
            'DSCF8254.jpeg',
            'DSCF8264.jpeg',
            'DSCF8266.jpeg',
            'DSCF8271.jpeg',
            'DSCF8272.jpeg',
            'DSCF8284.jpeg',
            'DSCF8285 Edited.jpeg',
            'DSCF8285.jpeg',
            'DSCF8288 Edited.jpeg',
            'DSCF8291.jpeg',
            'DSCF8298.jpeg',
            'DSCF8299 Edited.jpeg',
            'DSCF8307.jpeg',
            'DSCF8308.jpeg',
            'DSCF8320 Edited.jpeg',
            'DSCF8327.jpeg',
            'DSCF8332 Edited.jpeg',
            'DSCF8335 Edited.jpeg',
            'DSCF8336 Edited.jpeg',
            'DSCF8339 Edited.jpeg',
            'DSCF8342.jpeg',
            'DSCF8344.jpeg',
            'DSCF8347.jpeg',
            'DSCF8349.jpeg',
            'DSCF8353 Edited.jpeg',
            'DSCF8353.jpeg',
            'DSCF8354.jpeg',
            'DSCF8355.jpeg',
            'DSCF8358.jpeg',
            'DSCF8363.jpeg',
            'DSCF8364.jpeg',
            'DSCF8369.jpeg',
            'DSCF8373 Edited.jpeg',
            'DSCF8373.jpeg',
            'DSCF8379 Edited.jpeg',
            'DSCF8379.jpeg',
            'DSCF8381.jpeg',
            'DSCF8383.jpeg',
            'DSCF8384.jpeg',
            'DSCF8385.jpeg',
            'DSCF8386.jpeg',
            'DSCF8390.jpeg',
            'DSCF8392.jpeg',
            'DSCF8393.jpeg',
            'DSCF8394.jpeg',
            'DSCF8402.jpeg',
            'DSCF8406.jpeg',
            'DSCF8409 Edited.jpeg',
            'DSCF8409.jpeg',
            'DSCF8411.jpeg',
            'DSCF8427.jpeg',
            'DSCF8429.jpeg',
            'DSCF8433.jpeg',
            'DSCF8438.jpeg',
            'DSCF8440.jpeg',
            'DSCF8443 Edited.jpeg',
            'DSCF8443.jpeg',
            'DSCF8452.jpeg',
            'DSCF8458.jpeg',
            'DSCF8459.jpeg'
        ];

        // Create paths for different sizes
        const images = {
            thumbs: imageFiles.map(file => cdnBase + 'thumbs/' + file),
            medium: imageFiles.map(file => cdnBase + 'medium/' + file),
            full: imageFiles.map(file => cdnBase + file)
        };

        let currentImageIndex = 0;
        let loadedCount = 0;
        const IMAGES_PER_LOAD = 24; // Load 24 images at a time
        let isLoading = false;
        let slideshowInterval = null;
        let isSlideshowPlaying = false;

        // Generate gallery progressively
        const gallery = document.getElementById('gallery');
        const loadMoreContainer = document.getElementById('load-more-container');

        function loadMoreImages() {
            if (isLoading || loadedCount >= images.thumbs.length) return;

            isLoading = true;
            loadMoreContainer.style.display = 'block';

            // Simulate slight delay for UX (optional)
            setTimeout(() => {
                const endIndex = Math.min(loadedCount + IMAGES_PER_LOAD, images.thumbs.length);

                for (let index = loadedCount; index < endIndex; index++) {
                    const item = document.createElement('div');
                    item.className = 'gallery-item';
                    item.onclick = () => openLightbox(index);

                    const imgElement = document.createElement('img');
                    imgElement.src = images.thumbs[index];
                    imgElement.alt = `Photo ${index + 1}`;
                    imgElement.loading = 'lazy';

                    item.appendChild(imgElement);
                    gallery.appendChild(item);
                }

                loadedCount = endIndex;
                isLoading = false;

                // Hide loader if all images loaded
                if (loadedCount >= images.thumbs.length) {
                    loadMoreContainer.style.display = 'none';
                }
            }, 100);
        }

        // Intersection Observer for infinite scroll
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting && !isLoading) {
                    loadMoreImages();
                }
            });
        }, {
            rootMargin: '200px' // Load more when user is 200px from the bottom
        });

        // Start observing the load more container
        observer.observe(loadMoreContainer);

        // Load initial batch
        loadMoreImages();

        function openLightbox(index) {
            currentImageIndex = index;
            document.getElementById('lightbox-img').src = images.medium[index];
            document.getElementById('lightbox-download').href = images.full[index];
            document.getElementById('lightbox').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeLightbox() {
            stopSlideshow();
            document.getElementById('lightbox').classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        function changeImage(direction) {
            currentImageIndex += direction;
            if (currentImageIndex < 0) currentImageIndex = images.medium.length - 1;
            if (currentImageIndex >= images.medium.length) currentImageIndex = 0;
            document.getElementById('lightbox-img').src = images.medium[currentImageIndex];
            document.getElementById('lightbox-download').href = images.full[currentImageIndex];
        }

        function toggleSlideshow() {
            if (isSlideshowPlaying) {
                stopSlideshow();
            } else {
                startSlideshow();
            }
        }

        function startSlideshow() {
            isSlideshowPlaying = true;
            const btn = document.getElementById('slideshow-btn');
            btn.textContent = 'Diashow stoppen';
            btn.classList.add('playing');

            slideshowInterval = setInterval(() => {
                changeImage(1);
            }, 2000); // Change image every 2 seconds
        }

        function stopSlideshow() {
            if (slideshowInterval) {
                clearInterval(slideshowInterval);
                slideshowInterval = null;
            }
            isSlideshowPlaying = false;
            const btn = document.getElementById('slideshow-btn');
            btn.textContent = 'Diashow abspielen';
            btn.classList.remove('playing');
        }

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (document.getElementById('lightbox').classList.contains('active')) {
                if (e.key === 'Escape') closeLightbox();
                if (e.key === 'ArrowLeft') {
                    stopSlideshow();
                    changeImage(-1);
                }
                if (e.key === 'ArrowRight') {
                    stopSlideshow();
                    changeImage(1);
                }
                if (e.key === ' ') {
                    e.preventDefault();
                    toggleSlideshow();
                }
            }
        });

        // Close lightbox on background click
        document.getElementById('lightbox').addEventListener('click', (e) => {
            if (e.target.id === 'lightbox') closeLightbox();
        });
    </script>
</body>
</html>
